# PHP Project Boilerplate

### [English version of the readme](./README.md)

## Описание

Сборка для быстрого развертывания локального окружения для разработки на Laravel.
Предназначена для среды WSL (Windows Subsystem for Linux), тестировалась
на Ubuntu 22.04.2 LTS встроенной в Windows 10.

## Состав
* Laravel 10 (latest)
* PHP 8.2
* Xdebug
* Composer
* Node.js
* PostgreSQL 15.1
* pgAdmin
* MySQL 5.7

## Создание нового проекта Laravel
* Клонируйте репозиторий в новую директорию используя команду:
```
git clone https://github.com/A-Nikolaefff/laravel-project-boilerplate.git ИМЯ_ВАШЕГО_ПРОЕКТА
```
* **!!! Обязательно удалите файл .geetkeep** из директории **src**.
  В момент создания нового проекта эта папка обязательно должна быть пустой.
* В директории проекта выполните команду: 
```
make up
* ```
* После сборки и запуска всех контейнеров, в директории проекта выполните команду 
```
make init
```

* Проверьте, что проект доступен по адресу  http://localhost:8080/ . 
Первый запуск приложения может занять долгое время.

## Cписок команд
Для удобства управления все основные команды внесены в Makefile

* ```make build``` - сборка контейнеров
* ```make up``` - запуск контейнеров
* ```make down``` - остановка контейнеров
* ```make init``` - инициализация нового проекта Laravel
* ```make list``` - список запущенных контейнеров
* ```make enter name=SERVICE``` - зайти в запущенный контейнер (запустить терминал). Вместо ```SERVICE```
подставить имя сервиса согласно **docker-compose.yml**, например ```php```, ```pgsql``` или ```nginx```
* ```make php``` - зайти в контейнер php (запустить терминал)
* ```make npm``` - зайти в контейнер npm (запустить терминал)
* ```make vite``` - запустить встроенный dev сервер Vite для отслеживания изменений css и js файлов
* ```make vite-build``` - сборка css и js файлов для продакшена

## Настройка Xdebug в PHPStorm
* Имя сервера по умолчанию: **docker**
* Хост: **localhost**
* Порт: **8080**
* Использовать path mapping между директорией  **src** и путем **/var/www/html**

## Возможные проблемы

* Стандартная конфигурация Vite не предназначена для использования в докер-контейнере
  и поэтому не будет корректно работать из коробки. Для корректной работы отредактируйте
  файл конфигурации **vite.config.js**  добавив между строками ```export default defineConfig({```
  и ```plugins: [``` следующий код:
```
  server: {
  host: '0.0.0.0',
  hmr: {
  host: 'localhost'
  },
  port: 3009,
  watch: {
  usePolling: true
  }
  },
```

* Для корректной работы volumes докер-контейнера PostgreSQL необходимо,
  что бы UID/GID пользователя внутри контейнера соответствовали значению
  локального пользователя Linux. По умолчанию данный контейнер запускается
  с UID/GID 1000/1000. В случае если UID/GID локального пользователя отличаются
  необходимо выполнить команды ```export LOCAL_UID=$(id -u)``` и ```export LOCAL_GID=$(id -g)```
  перед первым запуском контейнера PostgreSQL.
